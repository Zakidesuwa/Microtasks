import{d as K,a as f,n as F}from"../chunks/vthok_eK.js";import"../chunks/DjKZgApb.js";import{ag as Ue,ah as z,g as r,ai as Ee,aj as d,ak as t,s as e,K as m,n as B,al as n}from"../chunks/BzRJZXn9.js";import{e as C,s as V}from"../chunks/DexkCHB1.js";import{i as j}from"../chunks/e8VI5U1H.js";import{b as M,r as S,s as A}from"../chunks/BBI8m-aS.js";import{s as De}from"../chunks/BTrMBUsU.js";import{t as ne,f as ie}from"../chunks/DoonBkoh.js";import{p as Be}from"../chunks/BDD76Zze.js";import{i as Ce}from"../chunks/Bq-VOS1f.js";import{G as je,s as Me,a as le,n as Se,i as Ae}from"../chunks/Hc-2lIR6.js";import{g as de}from"../chunks/BRtj5TtV.js";var Fe=K('<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4 text-sm" role="alert"><span class="block sm:inline"> </span></div>'),Te=F('<path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"></path>'),Le=F('<path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"></path>',1),Ne=K('<p id="passwordErrorMsg" class="text-xs text-red-600 mt-1"> </p>'),Oe=F('<path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"></path>'),He=F('<path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"></path>',1),Ze=K(`<main class="flex flex-col justify-center items-center min-h-screen w-full h-full bg-cover bg-fixed" style="background-image: url('/background.png'); background-position: center +783px;"><img src="/logonamin.png" alt="Microtask Logo" class="absolute top-10 left-10 h-12 scale-150 md:scale-250"> <h1 class="text-3xl font-bold text-center mb-6 text-black">Welcome to Microtask</h1> <form class="bg-white p-6 md:p-8 rounded-lg shadow-2xl border border-gray-300 max-w-md w-[90%] md:w-full"><h2 class="text-xl font-bold text-center mb-4">Sign up to continue</h2> <!> <div class="mb-4"><label for="username" class="block text-gray-700 mb-1 font-medium text-sm">Username</label> <input id="username" name="username" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm svelte-1rjc95u" required placeholder="Choose a username (letters, numbers, _)" aria-describedby="usernameHint"> <p id="usernameHint" class="text-xs text-gray-500 mt-1">Only letters, numbers, and underscores allowed.</p></div> <div class="mb-4"><label for="email" class="block text-gray-700 mb-1 font-medium text-sm">Email</label> <input id="email" name="email" type="email" class="w-full px-3 py-2 border border-gray-300 rounded-lg outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm svelte-1rjc95u" required placeholder="your@email.com"></div> <div class="mb-4"><label for="password" class="block text-gray-700 mb-1 font-medium text-sm">Password</label> <div class="relative"><input id="password" name="password" required placeholder="Create a password" aria-describedby="passwordHint passwordErrorMsg"> <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 cursor-pointer text-gray-500 hover:text-gray-700 p-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><!></svg></button></div> <p id="passwordHint" class="text-xs text-gray-500 mt-1">Min. 8 characters, with uppercase & lowercase letters.</p> <!></div> <div class="mb-6"><label for="confirmPassword" class="block text-gray-700 mb-1 font-medium text-sm">Re-type Password</label> <div class="relative"><input id="confirmPassword" name="confirmPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm svelte-1rjc95u" required placeholder="Confirm your password"> <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 cursor-pointer text-gray-500 hover:text-gray-700 p-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><!></svg></button></div></div> <div class="mt-6"><button type="submit" class="w-full bg-black text-white py-2.5 rounded-lg font-semibold transition duration-200 transform hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black disabled:opacity-60 disabled:cursor-not-allowed"> </button></div> <div class="relative my-5"><div class="absolute inset-0 flex items-center" aria-hidden="true"><div class="w-full border-t border-gray-300"></div></div> <div class="relative flex justify-center text-sm"><span class="px-2 bg-white text-gray-500">Or</span></div></div> <div class="mt-4"><button type="button" class="w-full border border-gray-300 flex items-center justify-center py-2.5 rounded-lg font-semibold cursor-pointer transition duration-200 transform hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-gray-400 disabled:opacity-60 disabled:cursor-not-allowed"><img src="/iconnggoogle.webp" alt="Google" class="h-5 mr-2"> <span class="text-sm text-gray-700">Sign up with Google</span></button></div> <div class="mt-5 text-center text-sm"><p class="text-gray-600">Already have an account? <a href="/login" class="text-blue-600 hover:underline font-medium">Log in</a></p></div></form></main>`);function es(ce,ue){Ue(ue,!1);let v=m(""),g=m(""),y=m(""),T=m(""),a=m(null),b=m(null),x=m(!1),k=m(!1),l=m(!1);function pe(s){const o={lowercase:/[a-z]/.test(s),uppercase:/[A-Z]/.test(s),minLength:s.length>=8};let i=[];return o.lowercase||i.push("one lowercase letter"),o.uppercase||i.push("one uppercase letter"),o.minLength||i.push("at least 8 characters"),i.length===0?"":`Password must contain ${i.join(", ")}.`}async function me(){var h,P;if(e(a,null),e(b,null),e(l,!0),!/^[a-zA-Z0-9_]+$/.test(r(v))){e(a,"Username can only contain letters, numbers, and underscores."),e(l,!1);return}const o=pe(r(y));if(o){e(b,o),e(a,null),e(l,!1);return}if(r(y)!==r(T)){e(a,"Passwords do not match."),e(l,!1);return}if(e(g,r(g).toLowerCase().trim()),!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r(g))){e(a,"Invalid email format."),e(l,!1);return}try{console.log(`[DEBUG] Attempting Firebase signup for email: ${r(g)}`);const w=(await Se(le,r(g),r(y))).user;console.log("[DEBUG] Firebase signup successful, user created:",w.uid);try{await Ae(w,{displayName:r(v)}),console.log("[DEBUG] Updated Firebase user profile with displayName:",r(v))}catch(u){console.error("[DEBUG] Failed to update Firebase profile:",u)}console.log("[DEBUG] Calling server action '?/saveUserProfile' to save profile data.");const D=new FormData;D.append("uid",w.uid),D.append("username",r(v)),D.append("email",w.email||r(g));let c;try{const u=await fetch("?/saveUserProfile",{method:"POST",body:D});if(c=await u.json(),console.log("[DEBUG] Server action response status:",u.status),console.log("[DEBUG] Server action response JSON:",JSON.stringify(c,null,2)),!u.ok||(c==null?void 0:c.type)==="failure"||((h=c==null?void 0:c.profileSave)==null?void 0:h.success)===!1){const W=((P=c==null?void 0:c.profileSave)==null?void 0:P.error)||(c==null?void 0:c.error)||"Failed to save user profile. Please try again.";console.error(`[DEBUG] Failed to save profile to Firestore: ${W}`),e(a,W),e(l,!1);return}console.log("[DEBUG] Successfully saved profile data via server action.")}catch(u){console.error("[DEBUG] Network or parsing error during saveUserProfile fetch:",u),e(a,"An error occurred connecting to the server to save your profile. Please try again."),e(l,!1);return}console.log("[DEBUG] Profile saved. Attempting to set session cookie..."),e(a,"Creating your session...");const Ge=await w.getIdToken(),te=await fetch("/api/auth/session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:Ge})});if(!te.ok){let u;try{u=await te.json()}catch{u={message:"Failed to parse session error response."}}console.error("[DEBUG] Failed to set session cookie after signup:",u),e(a,`Signup complete, but failed to create session (${u.message||"Unknown error"}). Please try logging in manually.`),e(l,!1);return}console.log("[DEBUG] Server session cookie set successfully after signup."),de("/login?message=signup_success")}catch(p){console.error("[DEBUG] Firebase signup error:",p.code,p.message),p.code==="auth/email-already-in-use"?e(a,"This email address is already registered. Try logging in."):p.code==="auth/invalid-email"?e(a,"The email address is not valid."):p.code==="auth/weak-password"?(e(a,"Password is too weak."),e(b,"Password is too weak.")):e(a,"An unexpected error occurred during signup. Please try again."),e(l,!1)}}async function ge(){e(a,null),e(l,!0);const s=new je;try{const i=(await Me(le,s)).user;console.log("[DEBUG] Google sign-up/in successful:",i.uid,i.displayName),console.log("[DEBUG] Attempting to set session cookie for Google user..."),e(a,"Creating your session...");const h=await i.getIdToken(),P=await fetch("/api/auth/session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:h})});if(!P.ok){let p;try{p=await P.json()}catch{p={message:"Failed to parse session error."}}console.error("[DEBUG] Failed to set session cookie after Google signup:",p),e(a,`Google sign-in complete, but failed to create session (${p.message||"Unknown error"}). Please try logging in again.`),e(l,!1);return}console.log("[DEBUG] Server session cookie set successfully for Google user."),de(`/home?username=${encodeURIComponent(i.displayName||"User")}`)}catch(o){console.error("[DEBUG] Google sign-up/in error:",o.code,o.message),o.code==="auth/popup-closed-by-user"?e(a,"Google sign-in was cancelled."):o.code==="auth/account-exists-with-different-credential"?e(a,"An account already exists with this email using a different sign-in method. Please log in using that method."):o.code==="auth/popup-blocked"?e(a,"Popup blocked by browser. Please allow popups for this site."):e(a,"Google sign-up failed. Please try again."),e(l,!1)}}function Q(s){s==="password"?e(x,!r(x)):s==="confirmPassword"&&e(k,!r(k))}Ce();var L=Ze(),N=d(t(L),4),X=d(t(N),2);{var fe=s=>{var o=Fe(),i=t(o),h=t(i,!0);n(i),n(o),z(()=>V(h,r(a))),ne(3,o,()=>ie),f(s,o)};j(X,s=>{r(a)&&s(fe)})}var O=d(X,2),Y=d(t(O),2);S(Y),B(2),n(O);var H=d(O,2),R=d(t(H),2);S(R),n(H);var Z=d(H,2),I=d(t(Z),2),_=t(I);S(_);var G=d(_,2),ee=t(G),ve=t(ee);{var be=s=>{var o=Te();f(s,o)},he=s=>{var o=Le();B(),f(s,o)};j(ve,s=>{r(x)?s(be):s(he,!1)})}n(ee),n(G),n(I);var we=d(I,4);{var ye=s=>{var o=Ne(),i=t(o,!0);n(o),z(()=>V(i,r(b))),ne(3,o,()=>ie),f(s,o)};j(we,s=>{r(b)&&s(ye)})}n(Z);var $=d(Z,2),se=d(t($),2),U=t(se);S(U);var E=d(U,2),re=t(E),xe=t(re);{var ke=s=>{var o=Oe();f(s,o)},_e=s=>{var o=He();B(),f(s,o)};j(xe,s=>{r(k)?s(ke):s(_e,!1)})}n(re),n(E),n(se),n($);var q=d($,2),J=t(q),Pe=t(J,!0);n(J),n(q);var oe=d(q,4),ae=t(oe);n(oe),B(2),n(N),n(L),z(()=>{A(_,"type",r(x)?"text":"password"),De(_,1,`w-full px-3 py-2 border ${(r(b)?"border-red-500":"border-gray-300")??""} rounded-lg outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm`,"svelte-1rjc95u"),A(G,"aria-label",r(x)?"Hide password":"Show password"),A(U,"type",r(k)?"text":"password"),A(E,"aria-label",r(k)?"Hide password":"Show password"),J.disabled=r(l),V(Pe,r(l)?"Signing up...":"Sign up"),ae.disabled=r(l)}),M(Y,()=>r(v),s=>e(v,s)),M(R,()=>r(g),s=>e(g,s)),M(_,()=>r(y),s=>e(y,s)),C("click",G,()=>Q("password")),M(U,()=>r(T),s=>e(T,s)),C("click",E,()=>Q("confirmPassword")),C("click",ae,ge),C("submit",N,Be(me)),f(ce,L),Ee()}export{es as component};
